<!doctype html>
<html>
<head>
  <title>PacVis</title>

  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/vis/4.16.1/vis.min.js"></script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/vis/4.16.1/vis.min.css" rel="stylesheet" type="text/css" />

  <style type="text/css">
    body{
      margin: 0 0 0 0;
      padding: 0 0 0 0;
    }
    .target {
      width: 100vw;
      height: 100vh;
      margin: 0 0 0 0;
      padding: 0 0 0 0;
    }
  </style>
</head>
<body>
<div id="target" class="target"></div>

  <script type="text/javascript">
    var nodes = new vis.DataSet([
      {% for node in nodes %}
        {id: {{node["id"]}}, label: '{{node["label"]}}', level: {{node["level"]}}, group: '{{node["group"]}}', title:'{{node["title"]}}'},
      {% end %}
    ]);


    var edges = new vis.DataSet([
      {% for link in links %}
        {from: {{link["from"]}}, to: {{link["to"]}}, arrows:"to" },
      {% end %}
    ]);

    // create a network
    var container = document.getElementById('target');
    var data = {
      nodes: nodes,
      edges: edges
    };
    var options = {
      groups: {
        standalone: { shape: 'square', size: 12 },
        normal: { shape: 'dot', color: 'rgb(200,255,200)'},
        explicit: { shape: 'dot', color: 'rgb(200,200,255)'},
        consolidated: { shape: 'star', color: 'red', size: 12},
      },
      nodes: {
        scaling: {
          // customScalingFunction: function (min,max,total,value) {
          //   return value/total;
          // },
        }
      },
      edges: {
         smooth: {
             type: 'cubicBezier',
             forceDirection: 'vertical' ,
             roundness: 0.4
         }
      },
      layout: {
         hierarchical: {
             direction: "UD",
             nodeSpacing: 200,
             treeSpacing: 150,
             levelSeparation: 130,
             blockShifting: false,
             edgeMinimization: false,
             parentCentralization: false
         },
        // repulsion: {
        //   nodeDistance: 400
        // },
        // barnesHut: {
        //   springLength: 300,
        //   springConstant: 0.1
        // },
        improvedLayout: true
      },
      // physics: false,
      physics: {
        maxVelocity: 1000,
        hierarchicalRepulsion: {
          nodeDistance: 200,
          springLength: 180,
          springConstant: 0.2,
          damping: 0.9,
          centralGravity: 0.1
        },
        timestep: 0.5,
        stabilization: {
          iterations: 20000,
          updateInterval: 100,
        }
      }
    };
    var network = new vis.Network(container, data, options);
    network.on("startStabilizing", function (params) {
      document.title = 'PacVis | ';
      console.log("started")
    });
    network.on("stabilizationProgress", function (params) {
      document.title = 'PacVis | ' +  Math.round(params.iterations/params.total*100) + "%";
      console.log("progress:",params);
    });
    network.on("stabilizationIterationsDone", function (params) {
      document.title = 'PacVis';
      console.log("finished stabilization interations");
    });
  </script>

</body>
</html>
